name: Meetup DotNet And Docker 
on:
 push:
    branches: [ main ]
  #pull_request:
   # branches: [ main ]
  #workflow_dispatch: 

env:
  RG_NAME: meetup-rg
  ACR_NAME: acrmeetup42
  IMG_TAG: dotnetandocker:v1
  ACR_SERVER: acrmeetup42.azurecr.io

jobs:

  build:

    runs-on: ubuntu-latest  #Exécuter les actions sur un agent Linux
    
    steps:
    - uses: actions/checkout@v2   
    - name:  Récupère .NET
      uses: actions/setup-dotnet@v1 
      with:
          dotnet-version: 5.0.x            
    - name: Publier le code source
      run:  
        dotnet publish -c release ./app/DotNetAndDocker.csproj -o ./app/publier      
    - name: Tester le code
      run:  echo "Il faudrait tester le code !!"
    - name: Construire et etiqueter image Docker      
      run:  
        docker build . --file ./app/Dockerfile --tag ${{ env.IMG_TAG }}
  
